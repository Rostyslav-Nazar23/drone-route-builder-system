# implementation-plan.md
## Система планування маршрутів літальних дронів

---

## 1. Мета реалізації

Реалізувати прикладну програмну систему планування маршрутів літальних дронів відповідно до опису в магістерській роботі, яка:

- запускається як Python-застосунок;
- надає користувацький веб-інтерфейс у браузері;
- дозволяє створювати та редагувати місії;
- підтримує ручне введення цільових точок або вибір їх на карті;
- дозволяє налаштовувати параметри одного або кількох дронів;
- підтримує різні режими планування (один дрон / мультидрон, з оптимізацією або без);
- опційно враховує метеодані;
- опційно використовує базу даних PostgreSQL/PostGIS;
- візуалізує побудований маршрут на карті;
- експортує маршрут у формат місії `.plan`.

Система повинна реалізовувати **повний функціональний цикл**, описаний у роботі:
ввід → обробка → планування → оптимізація → валідація → візуалізація → експорт.

---

## 2. Загальна архітектура системи

Система реалізується відповідно до багаторівневої архітектури:

### Рівні:
1. **Рівень введення даних**
2. **Рівень обробки та оптимізації**
3. **Рівень валідації**
4. **Рівень візуалізації**
5. **Рівень експорту**
6. **Інфраструктурний рівень (БД, зовнішні сервіси)**

Архітектура відповідає схемі архітектури та діаграмі розгортання:
- основна логіка працює **локально**;
- БД та зовнішні сервіси є **опційними**;
- UI відкривається у браузері користувача.

---

## 3. Технологічний стек

### Мова та середовище
- Python 3.10+
- Віртуальне середовище (venv / poetry)

### Backend
- FastAPI (REST API)
- Pydantic (DTO, валідація)
- Shapely / GeoPandas (геометрія)
- NetworkX (графи)
- OR-Tools (VRP)
- NumPy / SciPy (оптимізація)
- SQLAlchemy + GeoAlchemy2 (БД, опційно)
- psycopg2 (PostgreSQL)

### Frontend / UI
- Streamlit або FastAPI + Jinja2
- Folium / Leaflet (карта)
- Plotly (метрики, профілі)

### Інші
- OpenMeteo API (метеодані, опційно)
- Docker (опційно для БД)

---

## 4. Структура проєкту

```text
app/
├── main.py
├── api/
│   ├── mission.py
│   ├── planning.py
│   ├── export.py
│   └── visualization.py
├── orchestrator/
│   └── mission_orchestrator.py
├── data_import/
│   ├── importer.py
│   ├── csv_loader.py
│   ├── geojson_loader.py
│   └── validators.py
├── environment/
│   ├── graph_builder.py
│   ├── navigation_graph.py
│   └── cost_model.py
├── planning/
│   ├── route_planner.py
│   ├── a_star.py
│   ├── theta_star.py
│   └── d_star.py
├── optimization/
│   ├── vrp_solver.py
│   ├── mission_optimizer.py
│   └── genetic_optimizer.py
├── validation/
│   ├── constraint_checker.py
│   ├── zone_checker.py
│   ├── altitude_checker.py
│   ├── energy_checker.py
│   └── kinematics_checker.py
├── weather/
│   └── weather_provider.py
├── visualization/
│   └── map_renderer.py
├── export/
│   ├── plan_exporter.py
│   └── json_exporter.py
├── persistence/
│   ├── db.py
│   ├── repositories/
│   └── models.py
└── domain/
    ├── mission.py
    ├── drone.py
    ├── route.py
    ├── waypoint.py
    └── constraints.py

## 5. Функціональні вимоги
### 5.1 Управління місіями

створення, редагування та повторне відкриття місій;

підтримка сценаріїв одного та кількох дронів;

збереження місій у файлах або БД.

### 5.2 Введення даних

- введення цільових точок вручну;
- вибір точок на карті;
- імпорт зон обмежень у форматі GeoJSON;
- задання параметрів дронів (швидкість, батарея, висота);
- налаштування обмежень місії.

### 5.3 Побудова середовища

- формування навігаційного графа або дискретної сітки;
- урахування заборонених зон і висотних обмежень;
- побудова функції вартості ребер;
- інтеграція зовнішніх даних (погода, DEM) за потреби.

### 5.4 Планування маршрутів

- реалізація алгоритмів A*, Theta*, D*;
- формування базового маршруту;
- підтримка перепланування.

### 5.5 Мультидронові сценарії

- розподіл цільових точок між дронами (VRP);
- побудова окремого маршруту для кожного дрона;
- підтримка депо та повернення.

### 5.6 Оптимізація

- глобальна оптимізація маршрутів;
- генетичні алгоритми;
- ройові методи;
- багатокритеріальна функція пристосованості.

### 5.7 Валідація

- перевірка перетинів з no-fly зонами;
- перевірка висотних обмежень;
- перевірка енергетичних витрат;
- перевірка кінематичної здійсненності (Dubins Airplane);
- формування протоколу перевірок.

### 5.8 Візуалізація

- інтерактивна карта маршруту;
- відображення зон і точок;
- профіль висот;
- метрики маршруту.

### 5.9 Експорт

- експорт маршруту у формат .plan;
- альтернативні формати (JSON, CSV);
- збереження результатів експорту.

## 6. Дані та база даних
### 6.1 Модель даних

- missions
- drones
- mission_drones
- target_points
- no_fly_zones
- constraints
- routes
- route_points
- route_metrics
- export_files

### 6.2 Принципи використання БД

- база даних не є обов’язковою для роботи алгоритмів;
- всі розрахунки виконуються в оперативній пам’яті;
- БД використовується як інфраструктурне сховище;
- просторові перевірки можуть виконуватися на рівні PostGIS.

## 7. UI / UX вимоги

- запуск через браузер;
- карта як центральний елемент;
- покроковий сценарій роботи;
- можливість змінювати параметри та переплановувати маршрут;
- явне відображення помилок і порушень обмежень.

## 8. Послідовність розробки

- Реалізація доменної моделі
- Імпорт даних
- Побудова навігаційного графа
- Реалізація A*
- Візуалізація базового маршруту
- Реалізація перевірок обмежень
- Dubins Airplane
- VRP
- Оптимізація
- UI
- Експорт .plan
- Інтеграція БД
- Інтеграція метеоданих

## 9. Очікуваний результат

Результатом є працездатна програмна система, яка:

- відповідає магістерській роботі;
- демонструє коректність алгоритмів планування;
- може використовуватися як дослідницький або прикладний прототип;
- придатна для подальшого розширення.

## 11. Додаткові рекомендації для AI-реалізації

Для генерації коду нейронними мережами рекомендовано:

- реалізовувати систему модульно, починаючи з доменної моделі;
- чітко відокремлювати алгоритмічну логіку від UI;
- генерувати та перевіряти код кожного модуля окремо;
- починати з мінімального MVP (один дрон, A*, без БД);
- поступово підключати оптимізацію, VRP, БД та погоду;
- після кожного етапу виконувати ручне тестування.